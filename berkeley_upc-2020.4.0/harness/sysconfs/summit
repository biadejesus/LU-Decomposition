network = ibv
batch_sys = lsf

# Does not read job script from stdin as is/was standard for LSF
submit_cmd = 'bsub'

queues = [
    {
        Q_name     => batch,   
        Q_usennodes=> 1,
        Q_maxnode  => 32,      
        Q_minnode  => 1,       
        Q_maxtpn   => 20,      
        Q_maxtime  => 2:00:00 
    }
]

repository = CSC296

nthread_default = 16

max_nodes_to_run = 16

startjob_cmd = [
	'ulimit -s 10240', # libmxm complains loudly about the default unlimited stack size
	'GASNET_SSH_SERVERS=$( grep -v -e batch -e login $LSB_DJOB_HOSTFILE | sort -u | tr "\n" " " )',
	'export GASNET_SSH_SERVERS',
]

# IBM Job Step Manager is the supported spawner
# IBM Spectrum MPI is an Open MPI derivative
run_env_default = {
	OMPI_MCA_btl_openib_warn_default_gid_prefix => '0',
	MPIRUN_CMD => 'jsrun -p %N %C',
	MXM_LOG_LEVEL => 'error',
}
